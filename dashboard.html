<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Dashboard - Chegar Primeiro - Sistema seguro para clientes Claro solicitarem servi√ßos e manuten√ß√µes">
  <meta name="keywords" content="Claro, servi√ßos, manuten√ß√£o, clientes, internet, telefone, dashboard">
  <meta name="author" content="Claro">
  <meta name="robots" content="noindex, nofollow">
  
  <!-- Meta tags de seguran√ßa corrigidas -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' https://chegar-primeiro.onrender.com https://viacep.com.br https://brasilapi.com.br; font-src 'self' data:;">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-XSS-Protection" content="1; mode=block">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  
  <!-- PWA Support -->
  <meta name="theme-color" content="#d31a20">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <title>Dashboard - Chegar Primeiro</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="https://upload.wikimedia.org/wikipedia/commons/9/9c/LogoClaro2017.png">
</head>
<body>
  <div class="container">
    <!-- Header profissional -->
    <div class="dashboard-header">
      <div class="header-left">
        <div class="logo-section">
          <img src="https://upload.wikimedia.org/wikipedia/commons/9/9c/LogoClaro2017.png" class="logo" alt="Logo Claro">
          <div class="logo-text">
            <h1>Chegar Primeiro</h1>
            
          </div>
        </div>
      </div>
      
      <div class="header-right">
        <div class="user-profile" onclick="toggleUserMenu()">
          <div class="user-avatar">
            <span class="avatar-letter" id="userInitial">C</span>
          </div>
          <div class="user-details">
            <span id="welcomeUser" class="user-name">Bem-vindo, Cliente!</span>
            
          </div>
          <div class="dropdown-arrow">‚ñº</div>
        </div>
        
        <!-- Menu dropdown -->
        <div class="user-dropdown" id="userDropdown">
          <div class="dropdown-item" onclick="logout()">
            <span class="dropdown-icon"></span>
            <span>Sair</span>
          </div>
        </div>
      </div>
    </div>
    
    <h2 style="text-align:center; margin-bottom: 18px;">√Årea do Cliente</h2>
    
    <div id="areaAutenticada">
      <div class="tabs">
        <div class="tab active" onclick="showTab(0)">üîß Manuten√ß√£o</div>
        <div class="tab" onclick="showTab(1)">üì° Troca de Servi√ßo</div>
        <div class="tab" onclick="showTab(2)">Acompanhar Solicita√ß√£o</div>
      </div>
      
      <!-- Formul√°rio de Manuten√ß√£o -->
      <form id="formVistoria" class="active">
        <h3>üîß Solicitar Manuten√ß√£o</h3>
        
        <div class="field-container">
          <label>Nome</label>
          <input type="text" id="vistoriaNomeCliente" readonly style="background: #f8f9fa;">
        </div>
        
        <div class="field-container">
          <label>CPF</label>
          <input type="text" id="vistoriaCpf" readonly style="background: #f8f9fa;">
        </div>
        
        <div class="field-container">
          <label>CEP</label>
          <input type="text" id="vistoriaCep" maxlength="9" autocomplete="postal-code" placeholder="00000-000">
        </div>
        
        <div class="field-container">
          <label>Endere√ßo</label>
          <input type="text" id="vistoriaEndereco" autocomplete="street-address">
        </div>
        
        <div class="row">
          <div class="field-container">
            <label>Apartamento</label>
            <input type="text" id="vistoriaApartamento" autocomplete="address-line2">
          </div>
          <div class="field-container">
            <label>Bloco</label>
            <input type="text" id="vistoriaBloco" autocomplete="address-line3">
          </div>
        </div>
        
        <div class="field-container">
          <label>Servi√ßo atual</label>
          <input type="text" id="vistoriaServicoAtual" readonly style="background: #f8f9fa;">
        </div>
        
        <div class="field-container">
          <label>Telefone de contato</label>
          <input type="text" id="vistoriaTelefone" autocomplete="tel" placeholder="(11) 99999-9999">
          <small style="color: #666; font-size: 11px;">Formato: (11) 99999-9999</small>
        </div>
        
        <div class="field-container">
          <label>Descri√ß√£o do problema</label>
          <textarea id="vistoriaDescricao" required rows="3" style="resize: vertical; min-height: 60px;" placeholder="Descreva detalhadamente o problema que est√° enfrentando..."></textarea>
          <small style="color: #666; font-size: 11px;">Seja espec√≠fico para um atendimento mais r√°pido</small>
        </div>
        
        <div class="field-container">
          <label>Melhor hor√°rio de contato</label>
          <input type="time" id="vistoriaHorario" min="08:00" max="18:00">
          <small style="color: #666; font-size: 11px;">Hor√°rio comercial: 08:00 √†s 18:00</small>
        </div>
        
        <button class="submit-btn" type="submit">Enviar Solicita√ß√£o</button>
      </form>
      
      <!-- Formul√°rio de Troca de Servi√ßo -->
      <form id="formTrocaServico">
        <h3>üì° Troca de Servi√ßo</h3>
        
        <div class="field-container">
          <label>Nome</label>
          <input type="text" id="trocaNomeCliente" readonly style="background: #f8f9fa;">
        </div>
        
        <div class="field-container">
          <label>CPF</label>
          <input type="text" id="trocaCpf" readonly style="background: #f8f9fa;">
        </div>
        
        <div class="field-container">
          <label>Endere√ßo</label>
          <input type="text" id="trocaEndereco" readonly style="background: #f8f9fa;">
        </div>
        
        <div class="row">
          <div class="field-container">
            <label>Apartamento</label>
            <input type="text" id="trocaApartamento" readonly style="background: #f8f9fa;">
          </div>
          <div class="field-container">
            <label>Bloco</label>
            <input type="text" id="trocaBloco" readonly style="background: #f8f9fa;">
          </div>
        </div>
        
        <div class="field-container">
          <label>Servi√ßo atual</label>
          <input type="text" id="trocaServicoAtual" readonly style="background: #f8f9fa;">
        </div>
        
        <div class="field-container">
          <label>Novo servi√ßo</label>
          <div class="servico-contratado-row" id="trocaServicoContainer">
            <button type="button" class="select-service-btn" onclick="abrirModalServicos('troca')" id="btnSelecionarNovoServico">Selecionar novo servi√ßo</button>
          </div>
          <small style="color: #666; font-size: 11px;">Escolha o plano que melhor atende suas necessidades</small>
        </div>
        
        <button class="submit-btn" type="submit">Solicitar Troca</button>
      </form>
      
      <!-- Acompanhar Solicita√ß√£o -->
      <div id="acompanharSolicitacao" style="display:none;">
        <h3>Acompanhar Solicita√ß√£o</h3>
        
        <!-- Cards de a√ß√µes r√°pidas -->
        <div class="quick-actions">
          <div class="quick-action-card" onclick="focusProtocolInput()">
            <div class="quick-action-icon"></div>
            <div class="quick-action-content">
              <h4>Buscar por Protocolo</h4>
              <p>Digite o n√∫mero do protocolo para consultar</p>
            </div>
          </div>
          
          <div class="quick-action-card" onclick="showRecentRequests()">
            <div class="quick-action-icon"></div>
            <div class="quick-action-content">
              <h4>√öltimas Solicita√ß√µes</h4>
              <p>Veja suas solicita√ß√µes recentes</p>
            </div>
          </div>
        </div>
        
        <!-- Campo de busca moderno -->
        <div class="protocol-search-container">
          <div class="search-header">
            <h4>üîç Buscar Protocolo</h4>
            <span class="search-subtitle">Digite o n√∫mero do protocolo para consultar o status</span>
          </div>
          
          <div class="search-input-group">
            <div class="input-with-icon">
              <span class="input-icon"></span>
              <input 
                type="text" 
                id="inputProtocolo" 
                placeholder="Ex: 20250730100245" 
                maxlength="20"
                autocomplete="off"
              >
              <button type="button" class="clear-input-btn" onclick="clearProtocolInput()" style="display: none;">
                <span>‚úï</span>
              </button>
            </div>
            <button type="button" class="search-btn" id="btnBuscarProtocolo">
              <span class="search-btn-icon">üîç</span>
              <span class="search-btn-text">Buscar</span>
            </button>
          </div>
        </div>
        
        <!-- √Årea de resultados aprimorada -->
        <div id="resultadoAcompanhamento" class="result-container"></div>
        
        <!-- Loading state -->
        <div id="protocolLoading" class="protocol-loading" style="display: none;">
          <div class="loading-spinner"></div>
          <span>Buscando protocolo...</span>
        </div>
      </div>
    </div>

    <!-- Modal de sele√ß√£o de servi√ßos -->
    <div class="modal-servicos" id="modalServicos">
      <div class="modal-content">
        <span class="close-modal" onclick="fecharModalServicos()">&times;</span>
        <h3 style="color: #fff; text-align: center; margin-bottom: 25px; font-size: 24px;">
          Escolha seu Plano Claro
        </h3>
        <div class="servicos-grid" id="servicosGrid">
          <!-- Ofertas ser√£o carregadas dinamicamente -->
          <div class="loading-servicos" style="display: flex; justify-content: center; align-items: center; height: 200px; color: #fff;">
            <div class="spinner" style="border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid #fff; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-right: 15px;"></div>
            <span>Carregando planos...</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Iframe oculto para carregar ofertas em background -->
    <iframe 
      id="ofertasLoader" 
      src="ofertas-loader.html" 
      style="display: none; width: 0; height: 0; border: none;">
    </iframe>

    <!-- Overlay de loading -->
    <div id="loadingOverlay" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(255,255,255,0.7);z-index:10000;align-items:center;justify-content:center;">
      <div style="background:#fff;padding:32px 40px;border-radius:12px;box-shadow:0 2px 16px #0002;display:flex;flex-direction:column;align-items:center;gap:16px;">
        <div class="spinner" style="border:6px solid #eee;border-top:6px solid #ff0000;border-radius:50%;width:48px;height:48px;animation:spin 1s linear infinite;"></div>
        <span style="font-size:1.1em;color:#333;">Carregando...</span>
      </div>
    </div>

    <!-- Notifica√ß√£o -->
    <div class="notification" id="notification"></div>
    
    <!-- Modal de Protocolo -->
    <div class="protocol-modal" id="protocolModal" style="display: none;">
      <div class="protocol-modal-content">
        <div class="protocol-header">
          <div class="protocol-icon"></div>
          <h3>Protocolo Gerado com Sucesso!</h3>
        </div>
        
        <div class="protocol-body">
          <div class="protocol-number-container">
            <label>N√∫mero do Protocolo:</label>
            <div class="protocol-number" id="protocolNumber">-</div>
            <button class="copy-protocol-btn" onclick="copyProtocol()">
              <span>Copiar Protocolo</span>
            </button>
          </div>
          
          <div class="protocol-message" id="protocolMessage">
            Sua solicita√ß√£o foi registrada com sucesso!
          </div>
          
          <div class="protocol-instructions">
            <p><strong>Pr√≥ximos Passos:</strong></p>
            <ul>
              <li>Guarde este protocolo para consultas futuras</li>
              <li>Mantenha seu telefone pr√≥ximo nas pr√≥ximas 24 horas</li>
              <li>Acompanhe o status na aba "Acompanhar Solicita√ß√£o"</li>
              <li>Nossa equipe entrar√° em contato em breve</li>
            </ul>
          </div>
        </div>
        
        <div class="protocol-footer">
          <button class="protocol-close-btn" onclick="closeProtocolModal()">
            <span>Fechar!</span>
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <style>
    @keyframes spin { 
      0% { transform: rotate(0deg);} 
      100% { transform: rotate(360deg);} 
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideInUp {
      from { 
        opacity: 0; 
        transform: translateY(50px) scale(0.9); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
      }
    }
    
    @keyframes slideProtocol {
      0% { left: -100%; }
      100% { left: 100%; }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    /* Usar o mesmo padr√£o do projeto Claro */
    body {
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #000;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .container {
      width: 100vw;
      height: 100vh;
      background: linear-gradient(to bottom, #4d0607 20%, #d31a20 100%);
      color: #fff;
      padding: 24px 20px;
      text-align: center;
      box-sizing: border-box;
      overflow-y: auto;
    }
    
    /* Header profissional moderno */
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 25px 30px;
      margin-bottom: 40px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .header-left {
      display: flex;
      align-items: center;
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .dashboard-header .logo {
      height: 50px;
      width: auto;
      filter: none;
    }

    .logo-text h1 {
      font-size: 1.8rem;
      font-weight: 700;
      color: #2d3748;
      margin: 0;
      line-height: 1.2;
    }

    .logo-text .subtitle {
      font-size: 0.9rem;
      color: #718096;
      font-weight: 500;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 25px;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 12px;
      transition: all 0.3s ease;
      position: relative;
    }

    .user-profile:hover {
      background: rgba(196, 30, 58, 0.05);
    }

    .user-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: linear-gradient(135deg, #c41e3a, #ff4757);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(196, 30, 58, 0.3);
    }

    .avatar-letter {
      font-size: 1.2rem;
      color: white;
      font-weight: 700;
      text-transform: uppercase;
    }

    .user-details {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .user-name {
      font-size: 1rem;
      font-weight: 600;
      color: #2d3748;
      line-height: 1.2;
    }

    .user-role {
      font-size: 0.85rem;
      color: #718096;
      font-weight: 500;
    }

    .dropdown-arrow {
      font-size: 0.8rem;
      color: #718096;
      transition: transform 0.3s ease;
      margin-left: 8px;
    }

    .user-profile.active .dropdown-arrow {
      transform: rotate(180deg);
    }

    /* Dropdown menu */
    .user-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(0, 0, 0, 0.1);
      min-width: 160px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      z-index: 1000;
      margin-top: 8px;
    }

    .user-dropdown.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      border-radius: 8px;
      margin: 4px;
      color: #2d3748;
      font-weight: 500;
      font-size: 0.95rem;
    }

    .dropdown-item:hover {
      background: rgba(196, 30, 58, 0.1);
      color: #c41e3a;
      transform: translateX(2px);
    }

    .dropdown-item:active {
      transform: translateX(1px);
      background: rgba(196, 30, 58, 0.15);
    }

    .dropdown-icon {
      font-size: 1rem;
      opacity: 0.8;
    }

    .dropdown-item:hover .dropdown-icon {
      opacity: 1;
    }

    .header-actions {
      display: none;
    }
    
    /* T√≠tulo seguindo padr√£o */
    h2 {
      color: #fff;
      font-size: 28px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 30px;
    }
    
    /* Sistema de abas seguindo padr√£o do projeto */
    .tabs {
      display: flex;
      margin-bottom: 20px;
      gap: 2px;
    }
    
    .tab {
      flex: 1;
      padding: 15px 20px;
      text-align: center;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 12px 12px 0 0;
      font-weight: 500;
      font-size: 15px;
      transition: all 0.3s ease;
      color: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .tab:hover {
      background: rgba(255, 255, 255, 0.3);
      color: #fff;
    }
    
    .tab.active {
      background: rgba(255, 255, 255, 0.95);
      color: #d31a20;
      font-weight: 600;
    }
    
    /* Formul√°rios seguindo padr√£o das se√ß√µes */
    #areaAutenticada > form, 
    #areaAutenticada > div {
      animation: slideIn 0.5s ease-out;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.15);
    }
    
    #areaAutenticada > form h3,
    #areaAutenticada > div h3 {
      color: #fff;
      font-size: 18px;
      font-weight: 600;
      margin: 0 0 20px 0;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* Campos seguindo padr√£o do projeto */
    .field-container {
      margin-bottom: 20px;
      text-align: left;
    }
    
    .field-container label {
      display: block;
      margin-bottom: 8px;
      color: #fff;
      font-weight: 500;
      font-size: 14px;
    }
    
    .field-container input,
    .field-container textarea,
    .field-container select {
      width: 100%;
      background: rgba(255, 255, 255, 0.95);
      border: 2px solid transparent;
      border-radius: 8px;
      padding: 12px 16px;
      font-size: 14px;
      color: #333;
      transition: all 0.3s ease;
      font-family: inherit;
      box-sizing: border-box;
    }
    
    .field-container input:focus,
    .field-container textarea:focus,
    .field-container select:focus {
      outline: none;
      border-color: #fff;
      background: #fff;
      box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
    }
    
    .field-container input[readonly] {
      background: rgba(255, 255, 255, 0.7) !important;
      color: #666 !important;
      cursor: not-allowed;
    }
    
    .field-container small {
      display: block;
      margin-top: 5px;
      color: rgba(255, 255, 255, 0.7);
      font-size: 12px;
    }
    
    /* Bot√µes seguindo padr√£o do projeto */
    .submit-btn {
      margin-top: 18px;
      padding: 12px 30px;
      background: #ffffff;
      color: #690000;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      font-size: 1.1em;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      transition: transform 0.2s, box-shadow 0.2s;
      text-decoration: none;
      width: 100%;
    }
    
    .submit-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 10px rgba(0, 0, 0, 0.3);
    }
    
    .submit-btn:active {
      transform: scale(0.95);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    /* Servi√ßos selecionados */
    .select-service-btn {
      background: rgba(255, 255, 255, 0.2);
      color: #fff;
      border: 2px dashed rgba(255, 255, 255, 0.5);
      border-radius: 8px;
      padding: 20px;
      width: 100%;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    
    .select-service-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.8);
    }
    
    .servico-selecionado {
      background: rgba(255, 255, 255, 0.9);
      color: #333;
      border-radius: 8px;
      padding: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .servico-nome {
      font-weight: 600;
    }
    
    .btn-alterar-servico {
      background: #d31a20;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 8px 16px;
      font-size: 12px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    
    .btn-alterar-servico:hover {
      background: #b71717;
    }
    
    /* Modal seguindo padr√£o */
    .modal-servicos {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10001;
      animation: fadeIn 0.3s ease;
    }
    
    .modal-content {
      background: linear-gradient(to bottom, #4d0607 20%, #d31a20 100%);
      border-radius: 12px;
      padding: 30px;
      max-width: 90vw;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      position: relative;
      animation: slideIn 0.4s ease;
      color: #fff;
    }
    
    .close-modal {
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 28px;
      color: rgba(255, 255, 255, 0.8);
      cursor: pointer;
      transition: color 0.3s ease;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
    }
    
    .close-modal:hover {
      color: #fff;
      background: rgba(255, 255, 255, 0.2);
    }
    
    /* Cards de servi√ßo */
    .servicos-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .servico-card {
      background: rgba(255, 255, 255, 0.95);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      padding: 25px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      color: #333;
    }
    
    .servico-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
      border-color: #fff;
    }
    
    .servico-titulo {
      font-size: 20px;
      font-weight: 700;
      color: #2c3e50;
      margin-bottom: 10px;
    }
    
    .servico-mega {
      font-size: 32px;
      font-weight: 800;
      color: #d31a20;
      margin: 15px 0;
    }
    
    .servico-benef {
      color: #6c757d;
      font-size: 14px;
      margin: 15px 0;
      line-height: 1.4;
    }
    
    .servico-preco {
      font-size: 24px;
      font-weight: 700;
      color: #28a745;
      margin: 15px 0;
    }
    
    .servico-btn {
      background: #d31a20;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 25px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
    }
    
    .servico-btn:hover {
      background: #b71717;
      transform: translateY(-2px);
    }
    
    /* Responsividade */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      .dashboard-header {
        flex-direction: column;
        gap: 20px;
        padding: 20px;
        text-align: center;
      }

      .header-left,
      .header-right {
        width: 100%;
        justify-content: center;
      }

      .logo-section {
        justify-content: center;
      }

      .logo-text h1 {
        font-size: 1.5rem;
      }

      .header-right {
        flex-direction: column;
        gap: 15px;
      }

      .user-profile {
        justify-content: center;
        padding: 8px;
      }

      .dropdown-arrow {
        display: none;
      }

      .user-dropdown {
        right: 50%;
        transform: translateX(50%) translateY(-10px);
      }

      .user-dropdown.show {
        transform: translateX(50%) translateY(0);
      }
      
      .tabs {
        flex-direction: column;
        gap: 8px;
      }
      
      .tab {
        border-radius: 8px;
      }
      
      .servicos-grid {
        grid-template-columns: 1fr;
      }
      
      h2 {
        font-size: 24px;
      }
      
      /* Modal de protocolo em tablets */
      .protocol-modal {
        padding: 15px;
      }
      
      .protocol-modal-content {
        max-width: 90%;
        width: 90%;
      }
      
      .protocol-header {
        padding: 25px 20px;
      }
      
      .protocol-body {
        padding: 25px 20px;
      }
      
      .protocol-number {
        font-size: 1.6rem;
        padding: 18px 25px;
      }
      
      .protocol-footer {
        padding: 20px;
      }
      
      /* Responsividade para Acompanhar Solicita√ß√£o */
      .quick-actions {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .quick-action-card {
        padding: 15px;
        flex-direction: column;
        text-align: center;
        gap: 10px;
      }
      
      .quick-action-icon {
        font-size: 2rem;
      }
      
      .protocol-search-container {
        padding: 20px 15px;
        border-radius: 15px;
      }
      
      .search-input-group {
        flex-direction: column;
        gap: 15px;
        align-items: stretch;
      }
      
      .search-btn {
        width: 100%;
        padding: 17px 15px;
        height: 53px;
      }
      
      .suggestion-examples {
        flex-direction: column;
        align-items: center;
        gap: 8px;
      }
    }

    @media (max-width: 480px) {
      .dashboard-header {
        padding: 15px;
      }

      .logo-text h1 {
        font-size: 1.3rem;
      }

      .user-avatar {
        width: 40px;
        height: 40px;
      }

      .btn-logout {
        padding: 10px 16px;
        font-size: 0.85rem;
      }
      
      /* Modal de protocolo responsivo */
      .protocol-modal {
        padding: 10px;
        align-items: flex-start;
        padding-top: 5vh;
      }
      
      .protocol-modal-content {
        width: 100%;
        max-width: 100%;
        margin: 0;
        max-height: 85vh;
        border-radius: 15px;
      }
      
      .protocol-header {
        padding: 20px 15px;
        border-radius: 13px 13px 0 0;
      }
      
      .protocol-header h3 {
        font-size: 1.2rem;
        line-height: 1.3;
      }
      
      .protocol-icon {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }
      
      .protocol-body {
        padding: 20px 15px;
      }
      
      .protocol-number-container {
        margin-bottom: 20px;
      }
      
      .protocol-number-container label {
        font-size: 0.9rem;
        margin-bottom: 12px;
      }
      
      .protocol-number {
        font-size: 1.4rem;
        padding: 15px 20px;
        letter-spacing: 2px;
        margin-bottom: 15px;
        border-radius: 12px;
      }
      
      .copy-protocol-btn {
        padding: 10px 16px;
        font-size: 0.8rem;
      }
      
      .protocol-message {
        padding: 15px;
        margin-bottom: 20px;
        font-size: 0.95rem;
        line-height: 1.5;
      }
      
      .protocol-instructions {
        padding: 15px;
        font-size: 0.9rem;
      }
      
      .protocol-instructions p {
        font-size: 1rem;
        margin-bottom: 12px;
      }
      
      .protocol-instructions li {
        font-size: 0.85rem;
        margin-bottom: 6px;
        line-height: 1.4;
      }
      
      .protocol-footer {
        padding: 15px;
        border-radius: 0 0 13px 13px;
      }
      
      .protocol-close-btn {
        padding: 12px 30px;
        font-size: 1rem;
        width: 100%;
        border-radius: 12px;
      }
      
      /* Responsividade para Acompanhar Solicita√ß√£o - Mobile */
      .quick-action-card {
        padding: 12px;
      }
      
      .quick-action-icon {
        font-size: 1.8rem;
      }
      
      .protocol-search-container {
        padding: 15px 10px;
        margin-bottom: 20px;
      }
      
      .search-header h4 {
        font-size: 1.2rem;
      }
      
      .input-with-icon input {
        padding: 12px 15px 12px 45px;
        font-size: 0.95rem;
      }
      
      .input-icon {
        left: 12px;
        font-size: 1.1rem;
      }
      
      .search-btn {
        padding: 12px 20px;
        font-size: 0.95rem;
      }
    }
    
    @media (max-width: 320px) {
      .protocol-modal {
        padding: 5px;
        padding-top: 2vh;
      }
      
      .protocol-number {
        font-size: 1.2rem;
        padding: 12px 15px;
        letter-spacing: 1px;
      }
      
      .protocol-header h3 {
        font-size: 1.1rem;
      }
      
      .protocol-icon {
        font-size: 2rem;
      }
      
      .protocol-body {
        padding: 15px 10px;
      }
      
      .protocol-footer {
        padding: 12px 10px;
      }
    }
    
    /* Loading e notifica√ß√µes seguindo padr√£o */
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid #fff;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      z-index: 10002;
      transform: translateX(100%);
      opacity: 0;
      transition: all 0.4s ease;
      max-width: 350px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    }
    
    .notification.show {
      transform: translateX(0);
      opacity: 1;
    }
    
    .notification.success {
      background: #28a745;
    }
    
    .notification.error {
      background: #dc3545;
    }
    
    .notification.warning {
      background: #ffc107;
      color: #333;
    }
    
    .notification.info {
      background: #17a2b8;
    }
    
    /* Modal de Protocolo */
    .protocol-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10003;
      animation: fadeIn 0.3s ease;
      padding: 20px;
      box-sizing: border-box;
    }
    
    .protocol-modal-content {
      background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
      border-radius: 20px;
      padding: 0;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
      animation: slideInUp 0.4s ease;
      border: 2px solid rgba(196, 30, 58, 0.2);
      position: relative;
    }
    
    .protocol-header {
      background: linear-gradient(135deg, #8f0c22, #f10000);
      color: white;
      padding: 30px 25px;
      text-align: center;
      position: relative;
      border-radius: 18px 18px 0 0;
    }
    
    .protocol-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
      animation: shimmer 3s infinite;
      border-radius: 18px 18px 0 0;
    }
    
    .protocol-icon {
      font-size: 3.5rem;
      margin-bottom: 15px;
      animation: pulse 2s infinite;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
    }
    
    .protocol-header h3 {
      margin: 0;
      font-size: 1.6rem;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
      position: relative;
      z-index: 1;
    }
    
    .protocol-body {
      padding: 35px 30px;
      background: rgba(255, 255, 255, 0.95);
    }
    
    .protocol-number-container {
      text-align: center;
      margin-bottom: 30px;
      position: relative;
    }
    
    .protocol-number-container label {
      display: block;
      font-size: 1rem;
      color: #666;
      margin-bottom: 15px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .protocol-number {
      background: linear-gradient(135deg, #960019, #ff0000);
      color: white;
      padding: 20px 30px;
      border-radius: 15px;
      font-size: 2rem;
      font-weight: 800;
      letter-spacing: 3px;
      margin-bottom: 20px;
      box-shadow: 
        0 10px 30px rgba(196, 30, 58, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.1);
      position: relative;
      overflow: hidden;
    }
    
    .protocol-number::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      animation: slideProtocol 2s infinite;
    }
    
    @keyframes slideProtocol {
      0% { left: -100%; }
      100% { left: 100%; }
    }
    
    .copy-protocol-btn {
      background: rgba(196, 30, 58, 0.1);
      color: #c41e3a;
      border: 2px solid #c41e3a;
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .copy-protocol-btn:hover {
      background: #c41e3a;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(196, 30, 58, 0.3);
    }
    
    .protocol-message {
      background: linear-gradient(135deg, rgba(40, 167, 69, 0.1), rgba(32, 201, 151, 0.1));
      border-left: 5px solid #28a745;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 25px;
      font-weight: 500;
      color: #155724;
      line-height: 1.6;
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.1);
    }
    
    .protocol-instructions {
      background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 152, 0, 0.1));
      border-left: 5px solid #ffc107;
      padding: 20px;
      border-radius: 12px;
      color: #856404;
      box-shadow: 0 4px 15px rgba(255, 193, 7, 0.1);
    }
    
    .protocol-instructions p {
      margin: 0 0 15px 0;
      font-weight: 700;
      font-size: 1.1rem;
    }
    
    .protocol-instructions ul {
      margin: 0;
      padding-left: 25px;
    }
    
    .protocol-instructions li {
      margin-bottom: 8px;
      line-height: 1.5;
      font-weight: 500;
    }
    
    .protocol-footer {
      padding: 25px 30px;
      background: linear-gradient(135deg, rgba(248, 249, 250, 0.9), rgba(233, 236, 239, 0.9));
      text-align: center;
      border-radius: 0 0 18px 18px;
    }
    
    .protocol-close-btn {
      background: linear-gradient(135deg, #c41e3a, #ff4757);
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: 25px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 6px 20px rgba(196, 30, 58, 0.3);
      text-transform: uppercase;
      letter-spacing: 1px;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      justify-content: center;
    }
    
    .protocol-close-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(196, 30, 58, 0.4);
    }
    
    .protocol-close-btn:active {
      transform: translateY(-1px);
    }
    
    /* Estilo espec√≠fico para linhas de campos */
    .row {
      display: flex;
      gap: 16px;
      margin-bottom: 20px;
    }
    
    .row .field-container {
      flex: 1;
      margin-bottom: 0;
    }
    
    /* Protocolo display */
    #resultadoAcompanhamento {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    /* Estilos para Acompanhar Solicita√ß√£o */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .quick-action-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      display: flex;
      align-items: center;
      gap: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .quick-action-card:hover {
      transform: translateY(-5px);
      border-color: #c41e3a;
      box-shadow: 0 8px 25px rgba(196, 30, 58, 0.2);
    }
    
    .quick-action-icon {
      font-size: 2.5rem;
      background: linear-gradient(135deg, #c41e3a, #ff4757);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      flex-shrink: 0;
    }
    
    .quick-action-content h4 {
      margin: 0 0 5px 0;
      font-size: 1.1rem;
      font-weight: 700;
      color: #2d3748;
    }
    
    .quick-action-content p {
      margin: 0;
      font-size: 0.9rem;
      color: #718096;
      line-height: 1.4;
    }
    
    .protocol-search-container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      border: 2px solid rgba(196, 30, 58, 0.1);
    }
    
    .search-header {
      text-align: center;
      margin-bottom: 25px;
    }
    
    .search-header h4 {
      margin: 0 0 8px 0;
      font-size: 1.4rem;
      font-weight: 700;
      color: #2d3748;
    }
    
    .search-subtitle {
      font-size: 0.95rem;
      color: #718096;
    }
    
    .search-input-group {
      display: flex;
      gap: 15px;
      align-items: stretch;
      margin-bottom: 20px;
    }
    
    .input-with-icon {
      flex: 1;
      position: relative;
      display: flex;
      align-items: center;
    }
    
    .input-icon {
      position: absolute;
      left: 15px;
      font-size: 1.2rem;
      color: #c41e3a;
      z-index: 2;
    }
    
    .input-with-icon input {
      width: 100%;
      padding: 15px 20px 15px 50px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 500;
      transition: all 0.3s ease;
      background: white;
      color: #2d3748;
      height: 53px;
      box-sizing: border-box;
    }
    
    .input-with-icon input:focus {
      outline: none;
      border-color: #c41e3a;
      box-shadow: 0 0 0 3px rgba(196, 30, 58, 0.1);
    }
    
    .clear-input-btn {
      position: absolute;
      right: 15px;
      background: none;
      border: none;
      color: #718096;
      cursor: pointer;
      padding: 5px;
      border-radius: 50%;
      transition: all 0.3s ease;
      z-index: 2;
    }
    
    .clear-input-btn:hover {
      background: rgba(196, 30, 58, 0.1);
      color: #c41e3a;
    }
    
    .search-btn {
      background: linear-gradient(135deg, #c41e3a, #ff4757);
      color: white;
      border: none;
      padding: 17px 25px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 15px rgba(196, 30, 58, 0.3);
      min-width: 120px;
      justify-content: center;
      height: 53px;
      font-size: 1rem;
    }
    
    .search-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(196, 30, 58, 0.4);
    }
    
    .search-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .search-suggestions {
      text-align: center;
    }
    
    .suggestion-label {
      font-size: 0.85rem;
      color: #718096;
      margin-right: 10px;
    }
    
    .suggestion-examples {
      display: inline-flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .suggestion-example {
      background: rgba(196, 30, 58, 0.1);
      color: #c41e3a;
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid rgba(196, 30, 58, 0.2);
    }
    
    .suggestion-example:hover {
      background: #c41e3a;
      color: white;
      transform: translateY(-1px);
    }
    
    .result-container {
      min-height: 50px;
      transition: all 0.3s ease;
    }
    
    .protocol-loading {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      padding: 30px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      margin-top: 20px;
      color: #718096;
      font-weight: 500;
    }
    
    .loading-spinner {
      width: 30px;
      height: 30px;
      border: 3px solid rgba(196, 30, 58, 0.2);
      border-top: 3px solid #c41e3a;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    /* Estilos para os resultados de protocolo aprimorados */
    .protocol-result {
      background: #ffffff;
      border-radius: 12px;
      padding: 32px;
      margin-top: 24px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      border: 1px solid #e5e7eb;
      animation: slideInUp 0.3s ease;
    }

    .success-result {
      border-left: 4px solid #10b981;
    }

    .not-found-result {
      border-left: 4px solid #f59e0b;
    }

    .error-result {
      border-left: 4px solid #ef4444;
    }

    .result-header {
      display: flex;
      align-items: center;
      margin-bottom: 24px;
      gap: 16px;
    }

    .result-icon {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .success-icon {
      background: #ecfdf5;
      color: #10b981;
    }

    .warning-icon {
      background: #fffbeb;
      color: #f59e0b;
    }

    .error-icon {
      background: #fef2f2;
      color: #ef4444;
    }

    .result-header h4 {
      margin: 0;
      color: #111827;
      font-size: 24px;
      font-weight: 600;
      letter-spacing: -0.025em;
    }

    .protocol-info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .info-item {
      background: #f9fafb;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      transition: all 0.2s ease;
    }

    .info-item:hover {
      border-color: #d1d5db;
      background: #f3f4f6;
    }

    .info-item label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #6b7280;
      margin-bottom: 8px;
      text-transform: none;
      letter-spacing: normal;
    }

    .info-item span {
      font-size: 16px;
      color: #111827;
      font-weight: 500;
      line-height: 1.5;
    }

    .protocol-value {
      font-family: 'SF Mono', 'Monaco', 'Cascadia Code', 'Roboto Mono', monospace;
      background: #f3f4f6;
      padding: 8px 12px;
      border-radius: 6px;
      font-weight: 600 !important;
      color: #c41e3a !important;
      font-size: 18px !important;
      letter-spacing: 0.05em;
      border: 1px solid #e5e7eb;
    }

    .date-value {
      font-family: 'SF Mono', 'Monaco', 'Cascadia Code', 'Roboto Mono', monospace;
      background: #f3f4f6;
      padding: 8px 12px;
      border-radius: 6px;
      font-weight: 500 !important;
      color: #374151 !important;
      border: 1px solid #e5e7eb;
    }

    .type-badge {
      background: linear-gradient(135deg, #6b7280, #4b5563);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      letter-spacing: 0.025em;
    }

    .status-badge {
      padding: 10px 16px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      letter-spacing: 0.025em;
    }

    .status-badge.success {
      background: #ecfdf5;
      color: #065f46;
      border: 1px solid #a7f3d0;
    }

    .status-badge.warning {
      background: #fffbeb;
      color: #92400e;
      border: 1px solid #fcd34d;
    }

    .status-badge.info {
      background: #eff6ff;
      color: #1e40af;
      border: 1px solid #93c5fd;
    }

    .status-badge.error {
      background: #fef2f2;
      color: #991b1b;
      border: 1px solid #fca5a5;
    }

    .status-badge.secondary {
      background: #f9fafb;
      color: #374151;
      border: 1px solid #d1d5db;
    }

    .protocol-description {
      background: #f9fafb;
      padding: 24px;
      border-radius: 8px;
      margin-bottom: 24px;
      border: 1px solid #e5e7eb;
    }

    .protocol-description label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #6b7280;
      margin-bottom: 12px;
      text-transform: none;
      letter-spacing: normal;
    }

    .protocol-description p {
      margin: 0;
      color: #374151;
      line-height: 1.6;
      font-size: 16px;
    }

    .result-actions {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-top: 32px;
    }

    .action-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      flex: 1;
      justify-content: center;
      min-width: 160px;
      letter-spacing: 0.025em;
    }

    .action-btn svg {
      width: 16px;
      height: 16px;
    }

    .action-btn.primary {
      background: linear-gradient(135deg, #c41e3a, #dc2626);
      color: white;
      box-shadow: 0 4px 14px rgba(196, 30, 58, 0.25);
    }

    .action-btn.primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(196, 30, 58, 0.35);
      background: linear-gradient(135deg, #dc2626, #c41e3a);
    }

    .action-btn.secondary {
      background: #f9fafb;
      color: #374151;
      border: 1px solid #d1d5db;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .action-btn.secondary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      background: #f3f4f6;
      border-color: #9ca3af;
    }

    .not-found-content,
    .error-content {
      text-align: center;
      padding: 24px 0;
    }

    .not-found-content p,
    .error-content p {
      color: #6b7280;
      font-size: 16px;
      line-height: 1.6;
      margin-bottom: 16px;
    }

    .help-suggestions {
      background: #f9fafb;
      padding: 24px;
      border-radius: 8px;
      margin: 24px 0;
      text-align: left;
      border: 1px solid #e5e7eb;
    }

    .help-suggestions h5 {
      color: #374151;
      margin-bottom: 16px;
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 0.025em;
    }

    .help-suggestions ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .help-suggestions li {
      padding: 8px 0;
      color: #6b7280;
      font-size: 14px;
      position: relative;
      padding-left: 24px;
      line-height: 1.5;
    }

    .help-suggestions li::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 6px;
      height: 6px;
      background: #c41e3a;
      border-radius: 50%;
    }

    .loading-container {
      text-align: center;
      padding: 48px 24px;
      color: #6b7280;
    }

    .loading-container .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #f3f4f6;
      border-top: 3px solid #c41e3a;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    .loading-container p {
      font-size: 16px;
      font-weight: 500;
      color: #374151;
    }

    /* Responsividade para resultados de protocolo */
    @media (max-width: 768px) {
      .protocol-info-grid {
        grid-template-columns: 1fr;
      }
      
      .result-actions {
        flex-direction: column;
      }
      
      .action-btn {
        min-width: auto;
        flex: none;
      }
      
      .result-header {
        flex-direction: column;
        text-align: center;
        gap: 10px;
      }
      
      .protocol-result {
        padding: 20px 15px;
      }
    }

    @media (max-width: 480px) {
      .protocol-result {
        margin-top: 15px;
        padding: 15px;
        border-radius: 10px;
      }
      
      .result-icon {
        width: 40px;
        height: 40px;
        font-size: 20px;
      }
      
      .result-header h4 {
        font-size: 18px;
      }
      
      .info-item {
        padding: 12px;
      }
      
      .protocol-description {
        padding: 15px;
      }
      
      .action-btn {
        padding: 10px 15px;
        font-size: 13px;
      }
    }

  </style>
  
  <script src="navigation.js"></script>
  <script>
    // Inicializar dashboard
    document.addEventListener('DOMContentLoaded', function() {
      // Verificar se o usu√°rio est√° autenticado
      checkAuth();
      
      // Carregar dados do usu√°rio
      loadUserData();
      
      // Inicializar funcionalidades espec√≠ficas do dashboard
      if (typeof initializeDashboard === 'function') {
        initializeDashboard();
      }
      
      // Adicionar event listeners para formul√°rios
      initializeFormHandlers();
      
      // Adicionar busca de CEP autom√°tica
      initializeCepSearch();
      
      // Inicializar sistema de ofertas
      initializeServicos();
      
      // Mostrar primeira aba por padr√£o
      showTab(0);
    });

    // Vari√°veis globais para ofertas
    let ofertasDisponiveis = [];
    let ofertasLoaderReady = false;

    // Listener global para mensagens do iframe
    window.addEventListener('message', function(event) {
      // Verificar origem por seguran√ßa
      if (event.origin !== window.location.origin) return;
      
      console.log('[DEBUG] Mensagem recebida do iframe:', event.data);
      
      if (event.data.type === 'iframe-ready') {
        console.log('[INFO] Iframe reportou que est√° pronto');
        ofertasLoaderReady = true;
      } else if (event.data.type === 'ofertas-loaded') {
        console.log(`[INFO] Ofertas carregadas: ${event.data.status}`);
        ofertasDisponiveis = event.data.ofertas || [];
        
        // Se o modal estiver aberto, renderizar as ofertas IMEDIATAMENTE
        const modal = document.getElementById('modalServicos');
        if (modal && modal.style.display === 'flex') {
          console.log('[INFO] Modal aberto, renderizando ofertas imediatamente');
          renderizarServicos(ofertasDisponiveis);
          
          if (event.data.status === 'fallback') {
            showNotification('Usando ofertas padr√£o - Conex√£o limitada', 'info');
          }
        } else {
          console.log('[INFO] Ofertas carregadas em background, prontas para uso');
        }
      } else if (event.data.type === 'oferta-selected') {
        selecionarServico(event.data.nome, window.modalServicoContexto);
      }
    });

    // Fun√ß√£o para inicializar o carregador de ofertas
    function initOfertasLoader() {
      console.log('[INFO] Fun√ß√£o initOfertasLoader chamada');
      ofertasLoaderReady = true;
    }

    // Inicializar iframe quando ele carregar
    window.addEventListener('load', function() {
      console.log('[INFO] P√°gina carregada, configurando iframe...');
      const iframe = document.getElementById('ofertasLoader');
      if (iframe) {
        iframe.addEventListener('load', function() {
          console.log('[INFO] Iframe load event disparado');
          initOfertasLoader();
        });
        console.log('[INFO] Event listener adicionado ao iframe');
        
        // Verificar se o iframe j√° est√° carregado
        if (iframe.contentDocument && iframe.contentDocument.readyState === 'complete') {
          console.log('[INFO] Iframe j√° estava carregado, inicializando...');
          initOfertasLoader();
        }
      } else {
        console.error('[ERROR] Iframe n√£o encontrado!');
      }
    });

    // Fun√ß√£o para inicializar sistema de ofertas (simplificada)
    async function initializeServicos() {
      console.log('[INFO] Sistema de ofertas inicializado com carregador em background');
      // O iframe carregar√° as ofertas automaticamente
    }

    // Fun√ß√£o para abrir modal de servi√ßos (simplificada)
    async function abrirModalServicos(contexto) {
      window.modalServicoContexto = contexto;
      document.getElementById('modalServicos').style.display = 'flex';
      
      // Se j√° temos ofertas carregadas, renderizar imediatamente
      if (ofertasDisponiveis.length > 0) {
        renderizarServicos(ofertasDisponiveis);
      } else {
        // Mostrar loading e solicitar carregamento
        mostrarLoadingOfertas();
        
        if (ofertasLoaderReady) {
          // Solicitar carregamento ao iframe
          document.getElementById('ofertasLoader').contentWindow.postMessage({
            type: 'load-ofertas'
          }, '*');
        } else {
          // Fallback se iframe n√£o estiver pronto
          setTimeout(() => {
            if (ofertasDisponiveis.length === 0) {
              renderizarOfertasPadrao();
            }
          }, 2000);
        }
      }
    }

    // Fun√ß√£o para mostrar loading das ofertas
    function mostrarLoadingOfertas() {
      const servicosGrid = document.getElementById('servicosGrid');
      servicosGrid.innerHTML = `
        <div class="loading-servicos" style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 200px; color: #fff; grid-column: 1 / -1;">
          <div class="spinner" style="border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid #fff; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 15px;"></div>
          <span>Carregando planos...</span>
          <small style="margin-top: 8px; opacity: 0.8;">Sistema otimizado para carregamento r√°pido</small>
        </div>
      `;
      
      // Timeout de seguran√ßa - se depois de 5 segundos ainda estiver carregando, usar fallback
      setTimeout(() => {
        const modal = document.getElementById('modalServicos');
        if (modal && modal.style.display === 'flex' && ofertasDisponiveis.length === 0) {
          console.log('[TIMEOUT] For√ßando uso de ofertas padr√£o ap√≥s 5 segundos');
          renderizarOfertasPadrao();
        }
      }, 5000);
    }
    // Inicializar handlers dos formul√°rios
    function initializeFormHandlers() {
      // Form de manuten√ß√£o
      const formVistoria = document.getElementById('formVistoria');
      if (formVistoria) {
        formVistoria.addEventListener('submit', handleVistoriaSubmit);
      }
      
      // Form de troca de servi√ßo
      const formTroca = document.getElementById('formTrocaServico');
      if (formTroca) {
        formTroca.addEventListener('submit', handleTrocaSubmit);
      }
      
      // Busca de protocolo
      const btnBuscarProtocolo = document.getElementById('btnBuscarProtocolo');
      if (btnBuscarProtocolo) {
        btnBuscarProtocolo.addEventListener('click', buscarProtocolo);
      }
    }

    // Inicializar busca de CEP
    function initializeCepSearch() {
      const cepField = document.getElementById('vistoriaCep');
      if (cepField) {
        cepField.addEventListener('blur', function() {
          const cep = this.value.replace(/\D/g, '');
          if (cep.length === 8) {
            buscarEnderecoPorCep(cep);
          }
        });
      }
    }

    // Buscar endere√ßo por CEP
    async function buscarEnderecoPorCep(cep) {
      try {
        const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
        const data = await response.json();
        
        if (!data.erro) {
          const enderecoCompleto = `${data.logradouro}, ${data.bairro}, ${data.localidade} - ${data.uf}`;
          document.getElementById('vistoriaEndereco').value = enderecoCompleto;
          
          // Salvar no localStorage para usar em outras abas
          const userData = JSON.parse(localStorage.getItem('userData') || '{}');
          userData.endereco = enderecoCompleto;
          userData.cep = cep;
          localStorage.setItem('userData', JSON.stringify(userData));
          
          showNotification('Endere√ßo preenchido automaticamente!', 'success');
        }
      } catch (error) {
        console.error('Erro ao buscar CEP:', error);
        showNotification('N√£o foi poss√≠vel buscar o endere√ßo', 'error');
      }
    }

    // Handler para submit do formul√°rio de manuten√ß√£o
    async function handleVistoriaSubmit(e) {
      e.preventDefault();
      
      // Valida√ß√µes b√°sicas
      const nome = document.getElementById('vistoriaNomeCliente').value.trim();
      const cpf = document.getElementById('vistoriaCpf').value.replace(/\D/g, '');
      const descricao = document.getElementById('vistoriaDescricao').value.trim();
      
      if (!nome) {
        showNotification('‚ùå Por favor, preencha o nome', 'error');
        return;
      }
      
      if (!cpf || cpf.length !== 11) {
        showNotification('‚ùå Por favor, preencha um CPF v√°lido', 'error');
        return;
      }
      
      if (!descricao) {
        showNotification('‚ùå Por favor, descreva o problema', 'error');
        return;
      }
      
      const formData = {
        tipo: 'manutencao',
        cpf: cpf,
        nome_cliente: nome,
        cep: document.getElementById('vistoriaCep').value.replace(/\D/g, ''),
        endereco: document.getElementById('vistoriaEndereco').value.trim(),
        apartamento: document.getElementById('vistoriaApartamento').value.trim(),
        bloco: document.getElementById('vistoriaBloco').value.trim(),
        telefone: document.getElementById('vistoriaTelefone').value.replace(/\D/g, ''),
        descricao: descricao,
        melhor_horario: document.getElementById('vistoriaHorario').value,
        servico_atual: document.getElementById('vistoriaServicoAtual').value.trim()
      };
      
      console.log('Dados enviados para manuten√ß√£o:', formData);
      await submitSolicitacao(formData, 'manutencao');
    }

    // Handler para submit do formul√°rio de troca
    async function handleTrocaSubmit(e) {
      e.preventDefault();
      
      const novoServicoElement = document.querySelector('#trocaServicoContainer .servico-nome');
      if (!novoServicoElement) {
        showNotification('‚ùå Por favor, selecione um novo servi√ßo', 'error');
        return;
      }
      
      // Valida√ß√µes b√°sicas
      const nome = document.getElementById('trocaNomeCliente').value.trim();
      const cpf = document.getElementById('trocaCpf').value.replace(/\D/g, '');
      
      if (!nome) {
        showNotification('‚ùå Por favor, preencha o nome', 'error');
        return;
      }
      
      if (!cpf || cpf.length !== 11) {
        showNotification('‚ùå Por favor, preencha um CPF v√°lido', 'error');
        return;
      }
      
      const formData = {
        tipo: 'troca_servico',
        cpf: cpf,
        nome_cliente: nome,
        endereco: document.getElementById('trocaEndereco').value.trim(),
        apartamento: document.getElementById('trocaApartamento').value.trim(),
        bloco: document.getElementById('trocaBloco').value.trim(),
        servico_atual: document.getElementById('trocaServicoAtual').value.trim(),
        novo_servico: novoServicoElement.textContent.trim()
      };
      
      console.log('Dados enviados para troca de servi√ßo:', formData);
      await submitSolicitacao(formData, 'troca_servico');
    }

    // Enviar solicita√ß√£o para o servidor
    async function submitSolicitacao(formData, tipoSolicitacao) {
      try {
        showLoading(true);
        
        const response = await fetch('https://chegar-primeiro.onrender.com/api/solicitacoes', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });
        
        const result = await response.json();
        console.log('Resposta do servidor:', result);
        
        if (response.ok && result.success) {
          // Mensagens personalizadas por tipo de solicita√ß√£o
          let mensagemSucesso = '';
          let mensagemDetalhes = '';
          
          if (tipoSolicitacao === 'manutencao') {
            mensagemSucesso = '‚úÖ Solicita√ß√£o de Manuten√ß√£o Registrada!';
            mensagemDetalhes = 'Sua solicita√ß√£o foi registrada com sucesso! Em at√© 24 horas nossa equipe t√©cnica entrar√° em contato para agendar a visita.';
          } else if (tipoSolicitacao === 'troca_servico') {
            mensagemSucesso = '‚úÖ Solicita√ß√£o de Troca de Servi√ßo Registrada!';
            mensagemDetalhes = 'Sua solicita√ß√£o de troca foi registrada com sucesso! Em at√© 24 horas nossa equipe comercial entrar√° em contato para confirmar os detalhes e agendar a instala√ß√£o.';
          }
          
          // Mostrar mensagem de sucesso principal
          showNotification(mensagemSucesso, 'success', 8000);
          
          // Mostrar protocolo de forma destacada
          if (result.protocolo) {
            setTimeout(() => {
              showProtocolModal(result.protocolo, mensagemDetalhes);
            }, 1000);
          }
          
          // Limpar formul√°rio espec√≠fico
          clearForm(formData.tipo);
          
        } else {
          const errorMessage = result.error || result.motivo || 'Erro ao enviar solicita√ß√£o';
          showNotification(`‚ùå Erro: ${errorMessage}`, 'error');
        }
      } catch (error) {
        console.error('Erro ao enviar solicita√ß√£o:', error);
        showNotification('‚ùå Erro de conex√£o. Verifique sua internet e tente novamente.', 'error');
      } finally {
        showLoading(false);
      }
    }

    // Limpar formul√°rio ap√≥s envio
    function clearForm(tipo) {
      if (tipo === 'manutencao') {
        document.getElementById('vistoriaDescricao').value = '';
        document.getElementById('vistoriaHorario').value = '';
      } else if (tipo === 'troca_servico') {
        const container = document.getElementById('trocaServicoContainer');
        container.innerHTML = '<button type="button" class="select-service-btn" onclick="abrirModalServicos(\'troca\')" id="btnSelecionarNovoServico">Selecionar novo servi√ßo</button>';
      }
    }

    // Buscar protocolo
    async function buscarProtocolo() {
      const protocolo = document.getElementById('inputProtocolo').value.trim();
      
      if (!protocolo) {
        showNotification('Por favor, digite um n√∫mero de protocolo', 'error');
        focusProtocolInput();
        return;
      }
      
      try {
        showProtocolLoading(true);
        
        const response = await fetch(`https://chegar-primeiro.onrender.com/api/solicitacao/${protocolo}`);
        
        // Tratar especificamente o erro 404 (protocolo n√£o encontrado)
        if (response.status === 404) {
          displayProtocolResult({ protocolo }, 'not-found');
          showNotification('Protocolo n√£o encontrado', 'warning');
          return;
        }
        
        // Verificar se a resposta √© JSON v√°lida para outros status
        let result;
        const contentType = response.headers.get('content-type');
        
        if (contentType && contentType.includes('application/json')) {
          try {
            result = await response.json();
          } catch (jsonError) {
            console.error('Erro ao fazer parse do JSON:', jsonError);
            throw new Error('Resposta do servidor inv√°lida');
          }
        } else {
          // Se n√£o for JSON e n√£o for 404, tratar como erro de servidor
          throw new Error(`Erro do servidor (${response.status}): ${response.statusText}`);
        }
        
        // Se chegou aqui, a resposta foi bem-sucedida
        if (response.ok) {
          // A API retorna { success: true, solicitacao: {...} }
          const solicitacaoData = result.solicitacao || result;
          displayProtocolResult(solicitacaoData, 'success');
          saveRecentSearch(protocolo);
          showNotification('Protocolo encontrado com sucesso', 'success');
        } else {
          // Outros c√≥digos de erro com resposta JSON
          displayProtocolResult({ protocolo, error: result.error || result.message || 'Erro desconhecido' }, 'not-found');
          showNotification(`‚ö†Ô∏è ${result.error || result.message || 'Protocolo n√£o encontrado'}`, 'warning');
        }
        
      } catch (error) {
        console.error('Erro ao buscar protocolo:', error);
        
        // Distinguir entre diferentes tipos de erro
        if (error.name === 'TypeError' && error.message.includes('fetch')) {
          // Erro de rede/conex√£o
          displayProtocolResult(null, 'network-error');
          showNotification('Sem conex√£o com a internet. Verifique sua rede', 'error');
        } else if (error.message.includes('Resposta do servidor inv√°lida')) {
          // Erro de formato de resposta
          displayProtocolResult(null, 'server-error');
          showNotification('Erro interno do servidor. Tente novamente mais tarde', 'error');
        } else {
          // Outros erros
          displayProtocolResult(null, 'error');
          showNotification('Erro inesperado. Tente novamente', 'error');
        }
      } finally {
        showProtocolLoading(false);
      }
    }

    // Exibir resultado do protocolo com design moderno
    function displayProtocolResult(result, status) {
      const resultDiv = document.getElementById('resultadoAcompanhamento');
      
      if (status === 'success') {
        const statusColor = getStatusColor(result.status);
        const statusIcon = getStatusIcon(result.status);
        
        resultDiv.innerHTML = `
          <div class="protocol-result success-result">
            <div class="result-header">
              <div class="result-icon success-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <h4>Protocolo Encontrado</h4>
            </div>
            
            <div class="protocol-info-grid">
              <div class="info-item">
                <label>Protocolo</label>
                <span class="protocol-value">${result.protocolo}</span>
              </div>
              
              <div class="info-item">
                <label>Tipo de Solicita√ß√£o</label>
                <span class="type-badge">${formatSolicitationType(result.tipo)}</span>
              </div>
              
              <div class="info-item">
                <label>Status</label>
                <span class="status-badge ${statusColor}">${result.status || 'Em an√°lise'}</span>
              </div>
              
              <div class="info-item">
                <label>Data de Cria√ß√£o</label>
                <span class="date-value">${formatDate(result.data_criacao || result.data_registro)}</span>
              </div>
            </div>
            
            ${result.descricao ? `
              <div class="protocol-description">
                <label>Descri√ß√£o da Solicita√ß√£o</label>
                <p>${result.descricao}</p>
              </div>
            ` : ''}
            
            <div class="result-actions">
              <button class="action-btn secondary" onclick="copyProtocolToClipboard('${result.protocolo}')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M8 4v12a2 2 0 002 2h8a2 2 0 002-2V7.242a2 2 0 00-.602-1.43L16.083 2.57A2 2 0 0014.685 2H10a2 2 0 00-2 2z" stroke="currentColor" stroke-width="2"/>
                  <path d="M16 18v2a2 2 0 01-2 2H6a2 2 0 01-2-2V9a2 2 0 012-2h2" stroke="currentColor" stroke-width="2"/>
                </svg>
                Copiar Protocolo
              </button>
              <button class="action-btn primary" onclick="refreshProtocolStatus('${result.protocolo}')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Atualizar Status
              </button>
            </div>
          </div>
        `;
      } else if (status === 'not-found') {
        resultDiv.innerHTML = `
          <div class="protocol-result not-found-result">
            <div class="result-header">
              <div class="result-icon warning-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <h4>Protocolo N√£o Encontrado</h4>
            </div>
            
            <div class="not-found-content">
              <p>O protocolo <strong>${result.protocolo}</strong> n√£o foi encontrado em nosso sistema.</p>
              
              <div class="help-suggestions">
                <h5>Pontos de Verifica√ß√£o:</h5>
                <ul>
                  <li>Confirme se o n√∫mero do protocolo est√° correto</li>
                  <li>Verifique se n√£o h√° espa√ßos extras no in√≠cio ou fim</li>
                  <li>O protocolo pode demorar alguns minutos para ser processado</li>
                  <li>Certifique-se de que a solicita√ß√£o foi enviada com sucesso</li>
                </ul>
              </div>
              
              <div class="result-actions">
                <button class="action-btn secondary" onclick="clearProtocolSearch()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Nova Busca
                </button>
                <button class="action-btn primary" onclick="showHelpModal()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Preciso de Ajuda
                </button>
              </div>
            </div>
          </div>
        `;
      } else if (status === 'network-error') {
        resultDiv.innerHTML = `
          <div class="protocol-result error-result">
            <div class="result-header">
              <div class="result-icon error-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M18.364 5.636l-12.728 12.728m0-12.728l12.728 12.728" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                </svg>
              </div>
              <h4>Sem Conex√£o com a Internet</h4>
            </div>
            
            <div class="error-content">
              <p>N√£o foi poss√≠vel conectar √† internet.</p>
              <p>Verifique sua conex√£o e tente novamente.</p>
              
              <div class="help-suggestions">
                <h5>Sugest√µes de Solu√ß√£o:</h5>
                <ul>
                  <li>Verifique se o Wi-Fi est√° conectado</li>
                  <li>Teste sua conex√£o em outros sites</li>
                  <li>Aguarde alguns minutos e tente novamente</li>
                  <li>Reinicie seu roteador se necess√°rio</li>
                </ul>
              </div>
              
              <div class="result-actions">
                <button class="action-btn primary" onclick="buscarProtocolo()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Tentar Novamente
                </button>
                <button class="action-btn secondary" onclick="clearProtocolSearch()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M11 17l-5-5m0 0l5-5m-5 5h12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Voltar
                </button>
              </div>
            </div>
          </div>
        `;
      } else if (status === 'server-error') {
        resultDiv.innerHTML = `
          <div class="protocol-result error-result">
            <div class="result-header">
              <div class="result-icon error-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <h4>Erro Interno do Servidor</h4>
            </div>
            
            <div class="error-content">
              <p>Nossos servidores est√£o temporariamente indispon√≠veis.</p>
              <p>Nossa equipe t√©cnica j√° foi notificada.</p>
              
              <div class="help-suggestions">
                <h5>Pr√≥ximos Passos:</h5>
                <ul>
                  <li>Aguarde alguns minutos e tente novamente</li>
                  <li>Se o problema persistir, entre em contato conosco</li>
                  <li>Voc√™ pode tentar novamente mais tarde</li>
                  <li>Nosso suporte est√° dispon√≠vel para ajudar</li>
                </ul>
              </div>
              
              <div class="result-actions">
                <button class="action-btn primary" onclick="buscarProtocolo()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Tentar Novamente
                </button>
                <button class="action-btn secondary" onclick="showHelpModal()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Falar com Suporte
                </button>
              </div>
            </div>
          </div>
        `;
      } else {
        resultDiv.innerHTML = `
          <div class="protocol-result error-result">
            <div class="result-header">
              <div class="result-icon error-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                  <line x1="12" y1="8" x2="12" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <line x1="12" y1="16" x2="12.01" y2="16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </div>
              <h4>Erro Inesperado</h4>
            </div>
            
            <div class="error-content">
              <p>Ocorreu um erro inesperado durante a busca.</p>
              <p>Tente novamente ou entre em contato conosco.</p>
              
              <div class="result-actions">
                <button class="action-btn primary" onclick="buscarProtocolo()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Tentar Novamente
                </button>
                <button class="action-btn secondary" onclick="clearProtocolSearch()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 6v6m0 0v6m0-6h6m-6 0H6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  Nova Busca
                </button>
              </div>
            </div>
          </div>
        `;
      }
      
      // Animar entrada do resultado
      resultDiv.style.opacity = '0';
      setTimeout(() => {
        resultDiv.style.opacity = '1';
      }, 100);
    }

    // Fun√ß√£o para mostrar/ocultar loading
    function showLoading(show) {
      const overlay = document.getElementById('loadingOverlay');
      if (overlay) {
        overlay.style.display = show ? 'flex' : 'none';
      }
    }

    // Fun√ß√£o para mostrar notifica√ß√µes
    function showNotification(message, type = 'info', duration = 5000) {
      const notification = document.getElementById('notification');
      if (!notification) return;
      
      notification.className = `notification show ${type}`;
      notification.textContent = message;
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, duration);
    }

    // Fun√ß√£o para mostrar modal de protocolo
    function showProtocolModal(protocolo, mensagem) {
      const modal = document.getElementById('protocolModal');
      const protocolNumber = document.getElementById('protocolNumber');
      const protocolMessage = document.getElementById('protocolMessage');
      
      protocolNumber.textContent = protocolo;
      protocolMessage.textContent = mensagem;
      
      modal.style.display = 'flex';
      
      // Adicionar evento para fechar com ESC
      document.addEventListener('keydown', handleEscapeKey);
    }

    // Fun√ß√£o para fechar modal de protocolo
    function closeProtocolModal() {
      const modal = document.getElementById('protocolModal');
      modal.style.display = 'none';
      
      // Remover evento de ESC
      document.removeEventListener('keydown', handleEscapeKey);
    }

    // Fun√ß√£o para copiar protocolo
    function copyProtocol() {
      const protocolNumber = document.getElementById('protocolNumber').textContent;
      
      // Tentar usar a API moderna primeiro
      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(protocolNumber).then(() => {
          showNotification('Protocolo copiado para a √°rea de transfer√™ncia', 'success', 3000);
        }).catch(() => {
          fallbackCopyTextToClipboard(protocolNumber);
        });
      } else {
        fallbackCopyTextToClipboard(protocolNumber);
      }
    }

    // Fun√ß√£o fallback para copiar texto
    function fallbackCopyTextToClipboard(text) {
      const textArea = document.createElement("textarea");
      textArea.value = text;
      textArea.style.top = "0";
      textArea.style.left = "0";
      textArea.style.position = "fixed";
      
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      
      try {
        document.execCommand('copy');
        showNotification('Protocolo copiado para a √°rea de transfer√™ncia', 'success', 3000);
      } catch (err) {
        showNotification('‚ùå N√£o foi poss√≠vel copiar o protocolo', 'error', 3000);
      }
      
      document.body.removeChild(textArea);
    }

    // Fun√ß√£o para lidar com tecla ESC
    function handleEscapeKey(event) {
      if (event.key === 'Escape') {
        closeProtocolModal();
      }
    }

    // Fun√ß√£o para verificar autentica√ß√£o
    function checkAuth() {
      // Se n√£o estiver autenticado, redirecionar para login
      const isAuthenticated = localStorage.getItem('userAuthenticated');
      if (!isAuthenticated) {
        window.location.href = 'index-principal.html';
        return;
      }
    }

    // Fun√ß√£o para carregar dados do usu√°rio
    function loadUserData() {
      const userData = JSON.parse(localStorage.getItem('userData') || '{}');
      console.log('Dados do usu√°rio carregados:', userData);
      
      if (userData.nome) {
        document.getElementById('welcomeUser').textContent = `Bem-vindo, ${userData.nome}!`;
        
        // Atualizar inicial do avatar
        const inicial = userData.nome.charAt(0).toUpperCase();
        document.getElementById('userInitial').textContent = inicial;
        
        // Preencher todos os campos com dados do usu√°rio
        const fields = {
          'vistoriaNomeCliente': userData.nome,
          'trocaNomeCliente': userData.nome,
          'vistoriaCpf': userData.cpf || '',
          'trocaCpf': userData.cpf || '',
          'vistoriaEndereco': userData.endereco || '',
          'trocaEndereco': userData.endereco || '',
          'vistoriaApartamento': userData.apartamento || '',
          'trocaApartamento': userData.apartamento || '',
          'vistoriaBloco': userData.bloco || '',
          'trocaBloco': userData.bloco || '',
          'vistoriaTelefone': userData.telefone || '',
          'vistoriaServicoAtual': userData.servico_atual || 'Claro fibra 350 MEGA',
          'trocaServicoAtual': userData.servico_atual || 'Claro fibra 350 MEGA',
          'vistoriaCep': userData.cep || ''
        };
        
        Object.entries(fields).forEach(([fieldId, value]) => {
          const field = document.getElementById(fieldId);
          if (field && value) {
            field.value = value;
          }
        });
        
        // Formatar CPF e telefone se necess√°rio
        if (userData.cpf) {
          const cpfFormatado = formatCPF(userData.cpf);
          document.getElementById('vistoriaCpf').value = cpfFormatado;
          document.getElementById('trocaCpf').value = cpfFormatado;
        }
        
        if (userData.telefone) {
          const telefoneFormatado = formatTelefone(userData.telefone);
          document.getElementById('vistoriaTelefone').value = telefoneFormatado;
        }
        
        if (userData.cep) {
          const cepFormatado = formatCEP(userData.cep);
          document.getElementById('vistoriaCep').value = cepFormatado;
        }
      }
    }

    // Fun√ß√µes de formata√ß√£o
    function formatCPF(cpf) {
      const cleanCpf = cpf.replace(/\D/g, '');
      return cleanCpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
    }

    function formatTelefone(telefone) {
      const cleanTel = telefone.replace(/\D/g, '');
      if (cleanTel.length === 11) {
        return cleanTel.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
      }
      return telefone;
    }

    function formatCEP(cep) {
      const cleanCep = cep.replace(/\D/g, '');
      return cleanCep.replace(/(\d{5})(\d{3})/, '$1-$2');
    }

    // Fun√ß√£o para toggle do menu do usu√°rio
    function toggleUserMenu() {
      const dropdown = document.getElementById('userDropdown');
      const userProfile = document.querySelector('.user-profile');
      
      dropdown.classList.toggle('show');
      userProfile.classList.toggle('active');
    }

    // Fechar dropdown quando clicar fora
    document.addEventListener('click', function(event) {
      const userProfile = document.querySelector('.user-profile');
      const dropdown = document.getElementById('userDropdown');
      
      if (!userProfile.contains(event.target)) {
        dropdown.classList.remove('show');
        userProfile.classList.remove('active');
      }
    });

    // Fun√ß√£o de logout
    function logout() {
      localStorage.removeItem('userAuthenticated');
      localStorage.removeItem('userData');
      window.location.href = 'index-principal.html';
    }

    // Fun√ß√£o para trocar abas (melhorada)
    function showTab(index) {
      // Remover classe active de todas as abas
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      
      // Ocultar todos os formul√°rios e se√ß√µes
      const forms = document.querySelectorAll('#formVistoria, #formTrocaServico, #acompanharSolicitacao');
      forms.forEach(form => {
        form.style.display = 'none';
        form.classList.remove('active');
      });
      
      // Ativar aba selecionada
      const tabs = document.querySelectorAll('.tab');
      if (tabs[index]) {
        tabs[index].classList.add('active');
      }
      
      // Mostrar conte√∫do correspondente
      switch(index) {
        case 0:
          const formVistoria = document.getElementById('formVistoria');
          if (formVistoria) {
            formVistoria.style.display = 'flex';
            formVistoria.classList.add('active');
          }
          break;
        case 1:
          const formTroca = document.getElementById('formTrocaServico');
          if (formTroca) {
            formTroca.style.display = 'flex';
            formTroca.classList.add('active');
          }
          break;
        case 2:
          const acompanhar = document.getElementById('acompanharSolicitacao');
          if (acompanhar) {
            acompanhar.style.display = 'block';
            acompanhar.classList.add('active');
          }
          break;
      }
      
      // Recarregar dados do usu√°rio ao trocar de aba
      loadUserData();
    }

    // Fun√ß√£o para abrir modal de servi√ßos (corrigida)
    async function abrirModalServicos(contexto) {
      console.log(`[INFO] Abrindo modal para: ${contexto}`);
      window.modalServicoContexto = contexto;
      document.getElementById('modalServicos').style.display = 'flex';
      
      console.log(`[DEBUG] Abrindo modal - Ofertas dispon√≠veis: ${ofertasDisponiveis.length}`);
      console.log('[DEBUG] Estado do carregador:', { ofertasLoaderReady, ofertasDisponiveis: ofertasDisponiveis.length });
      
      // Se j√° temos ofertas carregadas, renderizar imediatamente
      if (ofertasDisponiveis.length > 0) {
        console.log('[INFO] Renderizando ofertas j√° carregadas');
        renderizarServicos(ofertasDisponiveis);
      } else {
        // Mostrar loading e solicitar carregamento
        console.log('[INFO] Nenhuma oferta carregada, iniciando carregamento');
        mostrarLoadingOfertas();
        
        if (ofertasLoaderReady) {
          console.log('[INFO] Solicitando carregamento ao iframe');
          // Solicitar carregamento ao iframe
          try {
            const iframe = document.getElementById('ofertasLoader');
            console.log('[DEBUG] Iframe encontrado:', !!iframe);
            console.log('[DEBUG] Iframe contentWindow:', !!iframe.contentWindow);
            iframe.contentWindow.postMessage({
              type: 'load-ofertas'
            }, '*');
            console.log('[INFO] Mensagem enviada ao iframe');
          } catch (error) {
            console.error('[ERROR] Erro ao comunicar com iframe:', error);
            renderizarOfertasPadrao();
          }
        } else {
          console.log('[WARN] Iframe n√£o pronto, aguardando...');
          // Aguardar iframe ficar pronto
          let tentativas = 0;
          const aguardarIframe = () => {
            tentativas++;
            console.log(`[DEBUG] Tentativa ${tentativas}/20 - Iframe ready: ${ofertasLoaderReady}`);
            
            if (ofertasLoaderReady && ofertasDisponiveis.length > 0) {
              console.log('[INFO] Iframe pronto, renderizando ofertas');
              renderizarServicos(ofertasDisponiveis);
            } else if (tentativas >= 20) {
              console.log('[WARN] Timeout aguardando iframe, usando fallback');
              renderizarOfertasPadrao();
            } else {
              setTimeout(aguardarIframe, 250);
            }
          };
          aguardarIframe();
        }
      }
    }

    // Fun√ß√£o para resetar circuit breaker manualmente
    function resetarCircuitBreaker() {
      console.log('[INFO] Reiniciando carregador de ofertas');
      ofertasDisponiveis = [];
      
      // Mostrar loading enquanto recarrega
      mostrarLoadingOfertas();
      
      if (ofertasLoaderReady) {
        console.log('[INFO] Enviando comando de reload para iframe');
        document.getElementById('ofertasLoader').contentWindow.postMessage({
          type: 'load-ofertas'
        }, '*');
      } else {
        console.log('[WARNING] Iframe n√£o est√° pronto, recarregando iframe');
        // Recarregar o iframe se necess√°rio
        const iframe = document.getElementById('ofertasLoader');
        iframe.src = iframe.src;
      }
    }

    // Fun√ß√£o para renderizar ofertas padr√£o como fallback (mantida para compatibilidade)
    function renderizarOfertasPadrao() {
      console.log('[FALLBACK] Renderizando ofertas padr√£o');
      
      const ofertasPadrao = [
        {
          nome: 'Claro fibra 350 MEGA',
          tipo: 'fibra',
          velocidade: '350 MEGA',
          beneficios: 'Wifi gr√°tis + Claro TV+ + Globoplay',
          preco: 79.90,
          preco_promocional: null
        },
        {
          nome: 'Claro fibra 250 MEGA',
          tipo: 'fibra', 
          velocidade: '250 MEGA',
          beneficios: 'Wifi gr√°tis + Claro TV+',
          preco: 69.90,
          preco_promocional: 59.90
        },
        {
          nome: 'Claro fibra 120 MEGA',
          tipo: 'fibra',
          velocidade: '120 MEGA', 
          beneficios: 'Wifi gr√°tis + Apps inclusos',
          preco: 49.90,
          preco_promocional: null
        },
        {
          nome: 'Claro m√≥vel 20GB',
          tipo: 'm√≥vel',
          velocidade: '20GB',
          beneficios: 'WhatsApp ilimitado + Redes sociais',
          preco: 39.90,
          preco_promocional: 29.90
        }
      ];
      
      ofertasDisponiveis = ofertasPadrao;
      renderizarServicos(ofertasPadrao);
    }

    // Fun√ß√£o para mostrar erro quando n√£o h√° ofertas no banco
    function mostrarErroSemOfertas() {
      const servicosGrid = document.getElementById('servicosGrid');
      servicosGrid.innerHTML = `
        <div style="color: #fff; text-align: center; grid-column: 1 / -1; padding: 40px;">
          <div style="background: rgba(255, 193, 7, 0.2); border: 2px solid #ffc107; border-radius: 12px; padding: 30px; max-width: 500px; margin: 0 auto;">
            <h4 style="color: #ffc107; margin-bottom: 15px; font-size: 24px;">‚ö†Ô∏è Nenhum plano dispon√≠vel</h4>
            <p style="margin-bottom: 20px; line-height: 1.6;">
              O banco de dados n√£o possui ofertas ativas no momento.<br>
              Voc√™ pode usar nossas ofertas padr√£o ou tentar novamente.
            </p>
            <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
              <button onclick="renderizarOfertasPadrao()" class="btn" style="background: #28a745; color: #fff; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer;">
                üì± Ver Ofertas Padr√£o
              </button>
              <button onclick="resetarCircuitBreaker()" class="btn" style="background: #ffc107; color: #000; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer;">
                üîÑ Tentar Novamente
              </button>
            </div>
          </div>
        </div>
      `;
    }

    // Fun√ß√£o para mostrar erro de timeout (simplificada)
    function mostrarErroTimeout() {
      const servicosGrid = document.getElementById('servicosGrid');
      servicosGrid.innerHTML = `
        <div style="color: #fff; text-align: center; grid-column: 1 / -1; padding: 40px;">
          <div style="background: rgba(220, 53, 69, 0.2); border: 2px solid #dc3545; border-radius: 12px; padding: 30px; max-width: 500px; margin: 0 auto;">
            <h4 style="color: #dc3545; margin-bottom: 15px; font-size: 24px;">‚è±Ô∏è Tempo limite excedido</h4>
            <p style="margin-bottom: 20px; line-height: 1.6;">
              O servidor est√° demorando para responder.<br>
              Usando ofertas padr√£o para melhor experi√™ncia.
            </p>
            <button onclick="renderizarOfertasPadrao()" class="btn" style="background: #28a745; color: #fff; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer;">
              üì± Ver Ofertas Padr√£o
            </button>
          </div>
        </div>
      `;
    }

    // Fun√ß√£o para mostrar erro de conex√£o (simplificada)
    function mostrarErroConexao() {
      const servicosGrid = document.getElementById('servicosGrid');
      servicosGrid.innerHTML = `
        <div style="color: #fff; text-align: center; grid-column: 1 / -1; padding: 40px;">
          <div style="background: rgba(220, 53, 69, 0.2); border: 2px solid #dc3545; border-radius: 12px; padding: 30px; max-width: 500px; margin: 0 auto;">
            <h4 style="color: #dc3545; margin-bottom: 15px; font-size: 24px;">‚ùå Erro de conex√£o</h4>
            <p style="margin-bottom: 20px; line-height: 1.6;">
              N√£o foi poss√≠vel conectar ao banco de dados.<br>
              Usando ofertas padr√£o para melhor experi√™ncia.
            </p>
            <button onclick="renderizarOfertasPadrao()" class="btn" style="background: #28a745; color: #fff; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer;">
              üì± Ver Ofertas Padr√£o
            </button>
          </div>
        </div>
      `;
    }

    // Fun√ß√£o para renderizar ofertas vindas do sistema de carregamento
    function renderizarServicos(ofertas) {
      const servicosGrid = document.getElementById('servicosGrid');
      
      if (!ofertas || ofertas.length === 0) {
        mostrarErroSemOfertas();
        return;
      }
      
      // Verificar se s√£o ofertas padr√£o e adicionar aviso
      const isOfertasPadrao = ofertas.length === 4 && ofertas[0].nome === 'Claro fibra 350 MEGA';
      const avisoFallback = isOfertasPadrao ? `
        <div style="grid-column: 1 / -1; background: rgba(255, 193, 7, 0.2); border: 1px solid #ffc107; border-radius: 8px; padding: 15px; margin-bottom: 20px; color: #fff; text-align: center;">
          <small>‚ö†Ô∏è Exibindo ofertas padr√£o - Conectividade otimizada</small>
        </div>
      ` : '';
      
      const servicosHTML = ofertas.map(oferta => {
        const precoFormatado = formatarPreco(oferta.preco);
        const precoPromocional = oferta.preco_promocional ? formatarPreco(oferta.preco_promocional) : null;
        
        return `
          <div class="servico-card" onclick="selecionarServico('${oferta.nome}', window.modalServicoContexto)">
            <div class="servico-titulo">
              Claro<span style='color:#ff0000'> ${oferta.tipo}</span>
            </div>
            <div class="servico-mega">${oferta.velocidade || ''}</div>
            <div class="servico-benef">${oferta.beneficios || ''}</div>
            <div class="servico-preco">
              ${precoPromocional ? `
                <span style="text-decoration: line-through; color: #999; font-size: 18px;">${precoFormatado}</span><br>
                <span style="color: #28a745; font-size: 24px; font-weight: 700;">${precoPromocional}</span>
              ` : precoFormatado}
            </div>
            <button type="button" class="servico-btn">
              ${oferta.tipo === 'fibra' ? 'Assine' : 'Contrate'}
            </button>
          </div>
        `;
      }).join('');
      
      servicosGrid.innerHTML = avisoFallback + servicosHTML;
      console.log(`[SUCCESS] ${ofertas.length} ofertas renderizadas com sucesso`);
    }

    // Fun√ß√£o auxiliar para formatar pre√ßo
    function formatarPreco(preco) {
      return `R$ ${parseFloat(preco).toFixed(2).replace('.', ',')}/m√™s`;
    }

    // Fun√ß√£o para fechar modal de servi√ßos
    function fecharModalServicos() {
      document.getElementById('modalServicos').style.display = 'none';
    }

    // Fun√ß√£o para selecionar servi√ßo (melhorada)
    function selecionarServico(nomeServico, contexto) {
      const container = document.getElementById(contexto + 'ServicoContainer');
      if (container) {
        container.innerHTML = `
          <div class="servico-selecionado" style="background: linear-gradient(135deg, #e8f5e8, #f0f9ff); border: 2px solid #28a745; border-radius: 10px; padding: 15px; display: flex; justify-content: space-between; align-items: center;">
            <div>
              <span class="servico-nome" style="font-weight: 600; color: #155724; display: block;">${nomeServico}</span>
              <small style="color: #6c757d;">Servi√ßo selecionado</small>
            </div>
            <button type="button" onclick="abrirModalServicos('${contexto}')" class="btn-alterar-servico" style="background: #ffc107; border: none; border-radius: 20px; padding: 8px 15px; font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.3s ease;">
              üîÑ Alterar
            </button>
          </div>
        `;
      }
      fecharModalServicos();
      showNotification('Servi√ßo selecionado com sucesso!', 'success');
    }

    // Melhorar estilo dos bot√µes de sele√ß√£o de servi√ßo
    function updateServiceButtonStyle() {
      const selectButtons = document.querySelectorAll('.select-service-btn');
      selectButtons.forEach(button => {
        button.style.cssText = `
          background: linear-gradient(135deg, #6c757d, #495057);
          color: white;
          border: none;
          border-radius: 10px;
          padding: 15px 20px;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.3s ease;
          width: 100%;
          font-size: 14px;
        `;
      });
    }

    // Fun√ß√µes auxiliares para a nova interface de acompanhamento
    function getStatusColor(status) {
      const statusMap = {
        'pendente': 'warning',
        'em andamento': 'info',
        'concluido': 'success',
        'cancelado': 'error',
        'aguardando': 'secondary'
      };
      return statusMap[status?.toLowerCase()] || 'info';
    }

    function getStatusIcon(status) {
      const iconMap = {
        'pendente': `<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm3.5 6L12 10.5 8.5 8 7 9.5l5 5 7-7-1.5-1.5z"/>
        </svg>`,
        'em andamento': `<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z"/>
        </svg>`,
        'concluido': `<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"/>
        </svg>`,
        'cancelado': `<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
        </svg>`,
        'aguardando': `<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M6,19H8L8,21H6V19M8,5H6L6,3H8V5M14,5V3H10V5H14M16,3V5H18L18,19H16V21H18A2,2 0 0,0 20,19V5A2,2 0 0,0 18,3H16M4,5A2,2 0 0,1 6,3V5H4V19H6V21A2,2 0 0,1 4,19V5Z"/>
        </svg>`
      };
      return iconMap[status?.toLowerCase()] || `<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
      </svg>`;
    }

    function formatSolicitationType(tipo) {
      const typeMap = {
        'instalacao': 'Instala√ß√£o',
        'mudanca': 'Mudan√ßa de Endere√ßo',
        'suporte': 'Suporte T√©cnico',
        'upgrade': 'Upgrade de Plano',
        'cancelamento': 'Cancelamento'
      };
      return typeMap[tipo] || tipo;
    }

    function formatDate(dateString) {
      if (!dateString) return 'N/A';
      const date = new Date(dateString);
      return date.toLocaleDateString('pt-BR', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    function showProtocolLoading(show) {
      const resultDiv = document.getElementById('resultadoAcompanhamento');
      
      if (show) {
        resultDiv.innerHTML = `
          <div class="loading-container">
            <div class="loading-spinner"></div>
            <p>Buscando protocolo...</p>
          </div>
        `;
      }
    }

    function focusProtocolInput() {
      const input = document.getElementById('inputProtocolo');
      if (input) {
        input.focus();
        input.select();
      }
    }

    function clearProtocolSearch() {
      document.getElementById('inputProtocolo').value = '';
      document.getElementById('resultadoAcompanhamento').innerHTML = '';
      focusProtocolInput();
    }

    function copyProtocolToClipboard(protocolo) {
      if (navigator.clipboard) {
        navigator.clipboard.writeText(protocolo).then(() => {
          showNotification('Protocolo copiado', 'success');
        }).catch(() => {
          showNotification('‚ùå Erro ao copiar protocolo', 'error');
        });
      } else {
        showNotification('‚ùå Erro ao copiar protocolo', 'error');
      }
    }

    function refreshProtocolStatus(protocolo) {
      document.getElementById('inputProtocolo').value = protocolo;
      buscarProtocolo();
    }

    function showHelpModal() {
      showNotification('Entre em contato conosco pelo chat ou telefone para ajuda', 'info');
    }

    function showRecentRequests() {
      const recent = JSON.parse(localStorage.getItem('recentProtocols') || '[]');
      
      if (recent.length === 0) {
        showNotification('Nenhuma solicita√ß√£o recente encontrada', 'info');
        return;
      }
      
      // Focar na aba de acompanhamento se n√£o estiver ativa
      showTab(2);
      
      // Exibir os protocolos recentes na √°rea de resultado
      const resultDiv = document.getElementById('resultadoAcompanhamento');
      
      resultDiv.innerHTML = `
        <div class="protocol-result success-result">
          <div class="result-header">
            <div class="result-icon success-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <h4>Seus Protocolos Recentes</h4>
          </div>
          
          <div class="recent-protocols-list">
            ${recent.map((protocolo, index) => `
              <div class="recent-protocol-item" style="background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 10px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <span style="font-weight: 600; color: #495057;">Protocolo: ${protocolo}</span>
                  <small style="display: block; color: #6c757d; margin-top: 2px;">Pesquisado recentemente</small>
                </div>
                <div style="display: flex; gap: 8px;">
                  <button onclick="searchProtocol('${protocolo}')" style="background: #007bff; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer;">
                    Consultar
                  </button>
                  <button onclick="copyProtocolToClipboard('${protocolo}')" style="background: #6c757d; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer;">
                    Copiar
                  </button>
                </div>
              </div>
            `).join('')}
          </div>
          
          <div class="result-actions" style="margin-top: 20px;">
            <button class="action-btn secondary" onclick="clearRecentProtocols()" style="background: #dc3545; color: white; border: none; padding: 10px 15px; border-radius: 8px; font-size: 14px; cursor: pointer;">
              Limpar Hist√≥rico
            </button>
            <button class="action-btn primary" onclick="clearProtocolSearch()" style="background: #28a745; color: white; border: none; padding: 10px 15px; border-radius: 8px; font-size: 14px; cursor: pointer; margin-left: 10px;">
              Nova Busca
            </button>
          </div>
        </div>
      `;
      
      // Animar entrada do resultado
      resultDiv.style.opacity = '0';
      setTimeout(() => {
        resultDiv.style.opacity = '1';
      }, 100);
      
      showNotification(`${recent.length} protocolo(s) recente(s) encontrado(s)`, 'success');
    }

    function saveRecentSearch(protocolo) {
      let recent = JSON.parse(localStorage.getItem('recentProtocols') || '[]');
      recent = recent.filter(p => p !== protocolo);
      recent.unshift(protocolo);
      recent = recent.slice(0, 5);
      localStorage.setItem('recentProtocols', JSON.stringify(recent));
    }

    function searchProtocol(protocolo) {
      document.getElementById('inputProtocolo').value = protocolo;
      buscarProtocolo();
    }

    function clearRecentProtocols() {
      localStorage.removeItem('recentProtocols');
      showNotification('Hist√≥rico de protocolos limpo com sucesso', 'success');
      clearProtocolSearch();
    }

    function showQuickActionFeedback(action) {
      const messages = {
        'nova-solicitacao': 'üÜï Redirecionando para nova solicita√ß√£o...',
        'chat-suporte': 'üí¨ Abrindo chat de suporte...',
        'historico': 'üìö Carregando hist√≥rico...'
      };
      
      showNotification(messages[action] || '‚úÖ A√ß√£o executada!', 'info');
      
      // Simular redirecionamento
      setTimeout(() => {
        if (action === 'nova-solicitacao') {
          // Pode redirecionar para p√°gina de nova solicita√ß√£o
          console.log('Redirecionando para nova solicita√ß√£o');
        }
      }, 1500);
    }

    // Event listeners para interatividade na nova interface
    function initializeTrackingInterface() {
      // Enter no input de protocolo
      const protocolInput = document.getElementById('inputProtocolo');
      if (protocolInput) {
        protocolInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            buscarProtocolo();
          }
        });
      }
    }

    // Atualizar estilos na inicializa√ß√£o
    setTimeout(() => {
      updateServiceButtonStyle();
      initializeTrackingInterface();
    }, 100);
  </script>
</body>
</html>
